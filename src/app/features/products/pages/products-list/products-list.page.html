<section
  class="bank-products"
  *ngIf="vm$ | async as vm"
  [attr.data-skel-on]="vm.loading ? '' : null"
>
  <div class="search-row">
    <input
      #q
      type="search"
      class="search-input"
      placeholder="Search..."
      (search)="onSearchInput(q.value)"
      (keyup.enter)="onSearchInput(q.value)"
      aria-label="Buscar productos"
    />
    <button class="primary" (click)="createProduct()">Agregar</button>
  </div>

  <div class="card">
    <div class="content-scroll">
      <table class="bp-table table-flow" role="table" aria-label="Productos">
        <colgroup>
          <col style="width: 80px" />
          <col style="width: 27.5%" />
          <col style="width: 27.5%" />
          <col style="width: 22.5%" />
          <col style="width: 22.5%" />
        </colgroup>

        <thead class="header">
          <tr>
            <th scope="col">Logo</th>
            <th scope="col">Nombre del producto</th>
            <th scope="col">
              Descripci√≥n
              <img src="../../../../assets/img/info.png" alt="M√°s" class="info" />
            </th>
            <th scope="col">
              Fecha de liberaci√≥n
              <img src="../../../../assets/img/info.png" alt="M√°s" class="info" />
            </th>
            <th scope="col">
              Fecha de reestructuraci√≥n
              <img src="../../../../assets/img/info.png" alt="M√°s" class="info" />
            </th>
            <th scope="col">Acciones</th>
          </tr>
        </thead>

        <tbody *ngIf="vm.loading">
          <tr *ngFor="let _ of [1,2,3,4,5]">
            <td>
              <span
                [appSkeleton]="true"
                skelType="circle"
                skelWidth="36px"
                skelHeight="36px"
              ></span>
            </td>
            <td><span [appSkeleton]="true" skelWidth="20%"></span></td>
            <td>
              <span [appSkeleton]="true" skelWidth="30%"></span>
            </td>
            <td><span [appSkeleton]="true" skelWidth="20%"></span></td>
            <td><span [appSkeleton]="true" skelWidth="20%"></span></td>
            <td></td>
          </tr>
        </tbody>
        <tbody *ngIf="!vm.loading">
          <tr
            class="row clickeable"
            *ngFor="let p of (vm.items | slice:0:vm.size); trackBy: trackById"
            [routerLink]="['/products', p.id, 'edit']"
            role="link"
            tabindex="0"
            (keydown.enter)="$event.preventDefault(); $any($event.currentTarget).click()"
            (keydown.space)="$event.preventDefault(); $any($event.currentTarget).click()"
          >
            <td class="logo">
              <img *ngIf="p.logo" [src]="p.logo" class="logo-img" alt="logo producto" />
              <span *ngIf="!p.logo" class="logo-fallback">{{ p.name | slice:0:2 }}</span>
            </td>
            <td class="name">{{ p.name }}</td>
            <td class="desc">{{ p.description }}</td>
            <td class="date">{{ p.date_release | date:'dd/MM/yyyy' }}</td>
            <td class="date">{{ p.date_revision | date:'dd/MM/yyyy' }}</td>
            <td class="actions">
              <button class="action-btn" (click)="toggleMenu(p.id, $event)">‚ãÆ</button>
              <div class="dropdown" *ngIf="openMenuId === p.id">
                <button (click)="onEdit(p, $event)">‚úèÔ∏è Editar</button>
                <button (click)="openDelete(p, $event)" [disabled]="isDeleting(p.id)">
                  üóëÔ∏è Eliminar
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="progressbar"><span class="bar"></span></div>
      <div class="footer">
        <span>{{ (vm.items | slice:0:vm.size).length }} Resultados</span>
        <select [value]="vm.size" #sz (change)="onSizeChange(sz.value)">
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
        </select>
      </div>
    </div>
  </div>
</section>

<app-confirm-modal
  [visible]="confirmOpen"
  [message]="'¬øEstas seguro que eliminar el producto‚Äú' + confirmTargetName + '‚Äù?'"
  [confirmText]="'Confirmar'"
  [cancelText]="'Cancelar'"
  (confirm)="confirmDelete()"
  (cancel)="cancelDelete()"
>
</app-confirm-modal>
